# ๐ ูุงุฆูุฉ ุงูุชุญูู ุงูุฃููู ุงูุดุงููุฉ - GoDarna

## ๐ฏ ูุฑุงุฌุนุฉ ูุง ูุจู ุงููุดุฑ

### โ **1. ุชูุนูู Row-Level Security**

- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `profiles`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `listings`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `bookings`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `payments`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `reviews`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `favorites`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `notifications`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `chats`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `chat_participants`
- [ ] ุชูุนูู RLS ุนูู ุฌุฏูู `messages`

### ๐ **2. ุงุฎุชุจุงุฑ ุงูุณูุงุณุงุช**

#### ุงุฎุชุจุงุฑ ุงููุณุชุฎุฏู ุงูุนุงุฏู (tenant):
- [ ] ูููู ุฑุคูุฉ ูููู ุงูุดุฎุตู ููุท
- [ ] ูููู ุฑุคูุฉ ุงูุนูุงุฑุงุช ุงูููุดูุฑุฉ ููุท
- [ ] ูููู ุฅูุดุงุก ุญุฌูุฒุงุช ุฌุฏูุฏุฉ
- [ ] ูููู ุฑุคูุฉ ุญุฌูุฒุงุชู ููุท
- [ ] ูููู ุฅุฏุงุฑุฉ ููุถูุชู ููุท
- [ ] ูููู ูุชุงุจุฉ ุชููููุงุช ููุญุฌูุฒุงุช ุงูููุชููุฉ ููุท
- [ ] ูุง ูููู ุฑุคูุฉ ุฅุดุนุงุฑุงุช ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู

#### ุงุฎุชุจุงุฑ ุงููุงูู (host):
- [ ] ูููู ุฅุฏุงุฑุฉ ุนูุงุฑุงุชู ููุท
- [ ] ูููู ุฑุคูุฉ ุญุฌูุฒุงุช ุนูุงุฑุงุชู
- [ ] ูููู ุชุญุฏูุซ ุญุงูุฉ ุงูุญุฌูุฒุงุช
- [ ] ูููู ุฑุคูุฉ ูุฏููุนุงุช ุนูุงุฑุงุชู
- [ ] ูุง ูููู ุฑุคูุฉ ุนูุงุฑุงุช ุงููุงูููู ุงูุขุฎุฑูู

#### ุงุฎุชุจุงุฑ ุงููุฏูุฑ (admin):
- [ ] ูุตูู ูุงูู ูุฌููุน ุงูุฌุฏุงูู
- [ ] ูููู ุชุญุฏูุซ ุฃุฏูุงุฑ ุงููุณุชุฎุฏููู
- [ ] ูููู ุฅุฏุงุฑุฉ ุฌููุน ุงูุนูุงุฑุงุช
- [ ] ูููู ุฑุคูุฉ ุฌููุน ุงููุฏููุนุงุช

### ๐ก๏ธ **3. ุฃูุงู ุงูุฏูุงู ูุงูู RPCs**

- [ ] ุฏุงูุฉ `is_admin()` ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุฏุงูุฉ `is_host()` ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุฏุงูุฉ `owns_listing()` ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุฏุงูุฉ `is_chat_participant()` ุชุนูู ุจุดูู ุตุญูุญ
- [ ] ุฏุงูุฉ `browse_public_listings()` ูุง ุชูุดู ุจูุงูุงุช ุญุณุงุณุฉ
- [ ] ุฏุงูุฉ `admin_update_user_role()` ูุญููุฉ ูููุฏูุฑูู ููุท

### ๐ **4. ุฃูุงู ุงูุชุฎุฒูู (Storage)**

- [ ] ุตูุฑ ุงูุนูุงุฑุงุช ุงูููุดูุฑุฉ ูุชุงุญุฉ ููุนููู
- [ ] ุฑูุน ุงูุตูุฑ ูููุฏ ูููุณุชุฎุฏููู ุงููุตุงุฏู ุนูููู
- [ ] ุชุนุฏูู/ุญุฐู ุงูุตูุฑ ูููุฏ ูุฃุตุญุงุจูุง
- [ ] ูุง ููุฌุฏ ุชุณุฑูุจ ูุตูุฑ ุงูุนูุงุฑุงุช ุบูุฑ ุงูููุดูุฑุฉ

### ๐ฑ **5. ุฃูุงู ุงูุชุทุจูู**

- [ ] ุงูุชุญูู ูู ุงูุฌูุณุฉ ูู ูู ุงุณุชุนูุงู
- [ ] ูุนุงูุฌุฉ ุฃุฎุทุงุก ุงูุฃูุงู ุจุดูู ููุงุณุจ
- [ ] ุนุฏู ุชุฎุฒูู ุจูุงูุงุช ุญุณุงุณุฉ ูุญููุงู
- [ ] ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ
- [ ] ุชุณุฌูู ุงูุนูููุงุช ุงูุญุณุงุณุฉ

## ๐จ ุงุฎุชุจุงุฑุงุช ุงูุซุบุฑุงุช ุงูุฃูููุฉ

### **1. ุงุฎุชุจุงุฑ ุชุณุฑูุจ ุงูุจูุงูุงุช**

```sql
-- ุงุฎุชุจุงุฑ 1: ูุญุงููุฉ ุงููุตูู ูุจูุงูุงุช ูุณุชุฎุฏู ุขุฎุฑ
SET LOCAL request.jwt.claim.sub = 'user-1-id';
SELECT * FROM public.profiles WHERE id = 'user-2-id'; -- ูุฌุจ ุฃู ูุนูุฏ 0 ุตููู

-- ุงุฎุชุจุงุฑ 2: ูุญุงููุฉ ุฑุคูุฉ ุญุฌูุฒุงุช ูุณุชุฎุฏู ุขุฎุฑ
SELECT * FROM public.bookings WHERE tenant_id = 'other-user-id'; -- ูุฌุจ ุฃู ูุนูุฏ 0 ุตููู

-- ุงุฎุชุจุงุฑ 3: ูุญุงููุฉ ุชุนุฏูู ุนูุงุฑ ูุณุชุฎุฏู ุขุฎุฑ
UPDATE public.listings SET title = 'hacked' WHERE host_id != auth.uid(); -- ูุฌุจ ุฃู ููุดู
```

### **2. ุงุฎุชุจุงุฑ ุชุตุนูุฏ ุงูุตูุงุญูุงุช**

```sql
-- ุงุฎุชุจุงุฑ 1: ูุญุงููุฉ ุชุญุฏูุซ ุฏูุฑ ุงููุณุชุฎุฏู ุจุฏูู ุตูุงุญูุฉ ูุฏูุฑ
SELECT public.admin_update_user_role('target-user-id', 'admin'); -- ูุฌุจ ุฃู ููุดู

-- ุงุฎุชุจุงุฑ 2: ูุญุงููุฉ ุงููุตูู ูุฏูุงู ุฅุฏุงุฑูุฉ
SELECT public.admin_update_listing_status('listing-id', false); -- ูุฌุจ ุฃู ููุดู ูููุณุชุฎุฏู ุงูุนุงุฏู
```

### **3. ุงุฎุชุจุงุฑ ุญูู SQL**

```dart
// ุงุฎุชุจุงุฑ ูู ุงูุชุทุจูู
final maliciousInput = "'; DROP TABLE profiles; --";
await PropertyService.searchProperties(maliciousInput); // ูุฌุจ ุฃู ูููู ุขูู
```

## ๐ ูุฑุงูุจุฉ ุงูุฃูุงู

### **1. ูุฑุงูุจุฉ ูุญุงููุงุช ุงููุตูู ุงููุดุจููุฉ**

```sql
-- ุฅูุดุงุก ุฌุฏูู ูุชุณุฌูู ูุญุงููุงุช ุงููุตูู ุงููุดุจููุฉ
CREATE TABLE IF NOT EXISTS public.security_logs (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID,
  action TEXT NOT NULL,
  table_name TEXT,
  attempted_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  ip_address INET,
  user_agent TEXT,
  success BOOLEAN DEFAULT false
);

-- ุฏุงูุฉ ูุชุณุฌูู ูุญุงููุงุช ุงููุตูู
CREATE OR REPLACE FUNCTION public.log_security_event(
  p_action TEXT,
  p_table_name TEXT DEFAULT NULL,
  p_success BOOLEAN DEFAULT false
)
RETURNS VOID AS $$
BEGIN
  INSERT INTO public.security_logs (user_id, action, table_name, success)
  VALUES (auth.uid(), p_action, p_table_name, p_success);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### **2. ุชูุจููุงุช ุงูุฃูุงู**

```sql
-- ุฏุงูุฉ ููุชุญูู ูู ูุญุงููุงุช ุงููุตูู ุงููุดุจููุฉ
CREATE OR REPLACE FUNCTION public.check_suspicious_activity()
RETURNS TABLE (
  user_id UUID,
  failed_attempts BIGINT,
  last_attempt TIMESTAMP WITH TIME ZONE
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    sl.user_id,
    COUNT(*) as failed_attempts,
    MAX(sl.attempted_at) as last_attempt
  FROM public.security_logs sl
  WHERE sl.success = false 
    AND sl.attempted_at > NOW() - INTERVAL '1 hour'
  GROUP BY sl.user_id
  HAVING COUNT(*) > 10; -- ุฃูุซุฑ ูู 10 ูุญุงููุงุช ูุงุดูุฉ ูู ุงูุณุงุนุฉ
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

## ๐ ุตูุงูุฉ ุฏูุฑูุฉ

### **ุฃุณุจูุนูุงู:**
- [ ] ูุฑุงุฌุนุฉ ุณุฌูุงุช ุงูุฃูุงู
- [ ] ุงูุชุญูู ูู ุงูุงุณุชุนูุงูุงุช ุงูุจุทูุฆุฉ
- [ ] ูุฑุงุฌุนุฉ ูุญุงููุงุช ุงููุตูู ุงููุงุดูุฉ

### **ุดูุฑูุงู:**
- [ ] ูุฑุงุฌุนุฉ ูุชุญุฏูุซ ุงูุณูุงุณุงุช
- [ ] ุงุฎุชุจุงุฑ ุงูุณูุงุณุงุช ูุน ุจูุงูุงุช ุฌุฏูุฏุฉ
- [ ] ูุฑุงุฌุนุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู
- [ ] ุชูุธูู ุณุฌูุงุช ุงูุฃูุงู ุงููุฏููุฉ

### **ุฑุจุน ุณูููุงู:**
- [ ] ูุฑุงุฌุนุฉ ุดุงููุฉ ููุฃูุงู
- [ ] ุงุฎุชุจุงุฑ ุงุฎุชุฑุงู ูุญุฏูุฏ
- [ ] ุชุญุฏูุซ ูููุงุช ุงููุฑูุฑ ุงูุฅุฏุงุฑูุฉ
- [ ] ูุฑุงุฌุนุฉ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ

## ๐จ ุฎุทุฉ ุงูุงุณุชุฌุงุจุฉ ููุญูุงุฏุซ

### **ูู ุญุงูุฉ ุงูุชุดุงู ุซุบุฑุฉ ุฃูููุฉ:**

1. **ุงูุงุณุชุฌุงุจุฉ ุงูููุฑูุฉ (0-15 ุฏูููุฉ):**
   - ุชุนุทูู ุงููุตูู ููุฌุฏูู ุงููุชุฃุซุฑ
   - ุชุณุฌูู ุชูุงุตูู ุงูุญุงุฏุซ
   - ุฅุดุนุงุฑ ุงููุฑูู ุงูุชููู

2. **ุงูุชูููู (15-60 ุฏูููุฉ):**
   - ุชุญุฏูุฏ ูุทุงู ุงูุชุฃุซูุฑ
   - ูุญุต ุณุฌูุงุช ุงููุตูู
   - ุชูููู ุงูุจูุงูุงุช ุงููุชุณุฑุจุฉ

3. **ุงูุฅุตูุงุญ (1-4 ุณุงุนุงุช):**
   - ุฅุตูุงุญ ุงูุซุบุฑุฉ
   - ุชุญุฏูุซ ุงูุณูุงุณุงุช
   - ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

4. **ุงููุชุงุจุนุฉ (24-48 ุณุงุนุฉ):**
   - ูุฑุงูุจุฉ ููุซูุฉ
   - ุฅุดุนุงุฑ ุงููุณุชุฎุฏููู ุงููุชุฃุซุฑูู
   - ุชูุซูู ุงูุญุงุฏุซ ูุงูุฏุฑูุณ ุงููุณุชูุงุฏุฉ

## ๐ ุฌูุงุช ุงูุงุชุตุงู

- **ูุฑูู ุงูุชุทููุฑ**: [ุงูุจุฑูุฏ ุงูุฅููุชุฑููู]
- **ูุฏูุฑ ุงูุฃูุงู**: [ุงูุจุฑูุฏ ุงูุฅููุชุฑููู]
- **ุงูุฏุนู ุงูุชููู**: [ุฑูู ุงููุงุชู]

---

**ุขุฎุฑ ุชุญุฏูุซ**: [ุงูุชุงุฑูุฎ]  
**ุงููุฑุงุฌุน**: ูุฑูู ุชุทููุฑ GoDarna
